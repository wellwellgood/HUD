<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HUD + Map (Naver)</title>
  <style>
    html,
    body {
      height: 100%;
      margin: 0;
      background: none;
      color: #0ff;
    }

    #app {
      position: relative;
      height: 100%;
    }

    #map {
      position: absolute;
      inset: 0;
    }

    .hud {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      padding: 16px;
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      pointer-events: none;
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
    }

    .speed {
      font-size: 64px;
      font-weight: 800;
      letter-spacing: 1px;
      text-shadow: 0 0 8px #0ff;
    }

    .meta {
      font-size: 14px;
      opacity: 0.9;
    }

    .panel {
      position: absolute;
      bottom: 12px;
      left: 12px;
      right: 12px;
      display: flex;
      gap: 8px;
      pointer-events: auto;
    }

    .btn {
      background: #011;
      color: #0ff;
      border: 1px solid #055;
      border-radius: 8px;
      padding: 10px 14px;
      font-weight: 700;
      cursor: pointer;
    }

    .mirror {
      transform: scaleX(-1);
    }
  </style>
</head>

<body>
  <div id="app">
    <div id="map" style="width:100%;height:100%;z-index: 0;"></div>
    <div id="hud" class="hud">
      <div class="speed" id="speed">--</div>
      <div class="meta">
        <div>HDG <span id="heading">--</span>¬∞</div>
        <div>LAT <span id="lat">--</span> ¬∑ LNG <span id="lng">--</span></div>
        <div>ACC <span id="acc">--</span>m ¬∑ SAT NA</div>
      </div>
    </div>
    <div class="panel">
      <button class="btn" id="mirrorBtn">ÎØ∏Îü¨ Î™®Îìú</button>
      <button class="btn" id="themeBtn">Îã§ÌÅ¨/ÎùºÏù¥Ìä∏</button>
      <button class="btn" id="pauseBtn">ÏùºÏãúÏ†ïÏßÄ</button>
    </div>
  </div>

  <!-- 1. Î®ºÏ†Ä ÎÑ§Ïù¥Î≤Ñ Maps API Î°úÎìú -->
  <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=i6my73bw6a"></script>

  <!-- 2. API Î°úÎìú ÏôÑÎ£å ÌõÑ Ïã§Ìñâ -->
  <script>
    // DOMÍ≥º naver Í∞ùÏ≤¥Í∞Ä Ï§ÄÎπÑÎê† ÎïåÍπåÏßÄ ÎåÄÍ∏∞
    window.addEventListener('load', function () {
      // naver Í∞ùÏ≤¥ ÌôïÏù∏
      if (typeof naver === 'undefined') {
        alert('ÎÑ§Ïù¥Î≤Ñ Maps API Î°úÎìú Ïã§Ìå®. Client IDÎ•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.');
        return;
      }

      (function () {
        // --- helpers ---
        const toKmh = (v) => (v == null ? null : Math.max(0, v * 3.6));
        const hav = (a) => Math.sin(a / 2) ** 2;
        const R = 6371000;
        const dist = (lat1, lon1, lat2, lon2) => {
          const œÜ1 = (lat1 * Math.PI) / 180,
            œÜ2 = (lat2 * Math.PI) / 180,
            dœÜ = ((lat2 - lat1) * Math.PI) / 180,
            dŒª = ((lon2 - lon1) * Math.PI) / 180;
          return (
            2 *
            R *
            Math.asin(
              Math.sqrt(hav(dœÜ) + Math.cos(œÜ1) * Math.cos(œÜ2) * hav(dŒª))
            )
          );
        };
        const bearing = (lat1, lon1, lat2, lon2) => {
          const œÜ1 = (lat1 * Math.PI) / 180,
            œÜ2 = (lat2 * Math.PI) / 180,
            Œª1 = (lon1 * Math.PI) / 180,
            Œª2 = (lon2 * Math.PI) / 180;
          const y = Math.sin(Œª2 - Œª1) * Math.cos(œÜ2);
          const x =
            Math.cos(œÜ1) * Math.sin(œÜ2) -
            Math.sin(œÜ1) * Math.cos(œÜ2) * Math.cos(Œª2 - Œª1);
          let Œ∏ = (Math.atan2(y, x) * 180) / Math.PI;
          return (Œ∏ + 360) % 360;
        };
        const ema = (alpha) => {
          let v = null;
          return (x) => {
            v = v == null ? x : alpha * x + (1 - alpha) * v;
            return v;
          };
        };

        // --- map ---
        const map = new naver.maps.Map("map", {
          center: new naver.maps.LatLng(37.5665, 126.978),
          zoom: 16,
          mapDataControl: false,
          logoControl: false,
          scaleControl: false,
          zoomControl: false,
          draggable: true,
          pinchZoom: true,
        });

        const me = new naver.maps.Marker({
          position: map.getCenter(),
          map,
          icon: { content: "üîµ", anchor: new naver.maps.Point(10, 10) },
        });

        // UI refs
        const $speed = document.getElementById("speed");
        const $heading = document.getElementById("heading");
        const $lat = document.getElementById("lat");
        const $lng = document.getElementById("lng");
        const $acc = document.getElementById("acc");
        const $app = document.getElementById("app");
        const hud = document.getElementById("hud");

        // controls
        document.getElementById("mirrorBtn").onclick = () =>
          $app.classList.toggle("mirror");
        let dark = true;
        document.getElementById("themeBtn").onclick = () => {
          dark = !dark;
          document.body.style.background = dark ? "#000" : "#fff";
          hud.style.color = dark ? "#0ff" : "#005";
        };
        let paused = false;
        document.getElementById("pauseBtn").onclick = () => {
          paused = !paused;
          document.getElementById("pauseBtn").textContent = paused
            ? "Ïû¨Í∞ú"
            : "ÏùºÏãúÏ†ïÏßÄ";
        };

        // state
        let last = null;
        const smoothSpeed = ema(0.35);
        const smoothHeading = ema(0.25);
        let compass = null;

        // device orientation
        window.addEventListener(
          "deviceorientation",
          (e) => {
            const hdg =
              e.webkitCompassHeading != null
                ? e.webkitCompassHeading
                : 360 - (e.alpha || 0);
            if (!isNaN(hdg)) compass = (hdg + 360) % 360;
          },
          true
        );

        // geolocation stream
        if (!navigator.geolocation) {
          alert("Geolocation ÎØ∏ÏßÄÏõê");
          return;
        }
        const watchId = navigator.geolocation.watchPosition(onPos, onErr, {
          enableHighAccuracy: true,
          maximumAge: 0,
          timeout: 10000,
        });

        function onPos(p) {
          if (paused) return;
          const { latitude, longitude, accuracy, speed: vms } = p.coords;
          const now = { lat: latitude, lng: longitude, t: p.timestamp };
          let kmh = toKmh(vms);
          let hdg = compass;

          if (last) {
            const d = dist(last.lat, last.lng, now.lat, now.lng);
            const dt = Math.max(0.5, (now.t - last.t) / 1000);
            const v = d / dt;
            if (kmh == null || isNaN(kmh)) kmh = toKmh(v);
            if (hdg == null)
              hdg = bearing(last.lat, last.lng, now.lat, now.lng);
          }

          if (kmh != null) kmh = smoothSpeed(kmh);
          if (hdg != null) hdg = smoothHeading(hdg);

          // update map
          const latlng = new naver.maps.LatLng(now.lat, now.lng);
          me.setPosition(latlng);
          map.setCenter(latlng);
          if (hdg != null) map.setHeading(hdg);

          // update HUD
          $speed.textContent = kmh != null ? Math.round(kmh) : "--";
          $heading.textContent = hdg != null ? Math.round(hdg) : "--";
          $lat.textContent = now.lat.toFixed(6);
          $lng.textContent = now.lng.toFixed(6);
          $acc.textContent = accuracy != null ? Math.round(accuracy) : "--";

          last = now;
        }

        function onErr(err) {
          alert("ÏúÑÏπò Ïò§Î•ò: " + err.message);
        }

        // iOS Í∂åÌïú ÏöîÏ≤≠
        if (
          window.DeviceOrientationEvent &&
          typeof DeviceOrientationEvent.requestPermission === "function"
        ) {
          window.addEventListener("click", async function once() {
            window.removeEventListener("click", once);
            try {
              await DeviceOrientationEvent.requestPermission();
            } catch (e) { }
          });
        }
      })();
    });

    console.log(typeof naver);
    console.log(naver.maps);
    console.log(document.getElementById('map'));
  </script>
</body>

</html>